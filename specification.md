# 초자연재난관리국 인트라넷 시스템 "해태"

> **프로젝트 개요**: 환경부 초자연재난관리국의 내부 행정 시스템으로, 초자연적 재난(어둠)에 대응하는 요원들을 위한 통합 인트라넷 애플리케이션
>
> **시스템 버전**: v2.0
> **보안 등급**: 대외비

---

## 📁 기술 스택

| 분류 | 기술 |
|------|------|
| **프레임워크** | React 18 + TypeScript |
| **빌드 도구** | Vite |
| **UI 컴포넌트** | shadcn/ui + Radix UI |
| **스타일링** | Tailwind CSS |
| **상태 관리** | React Context API, TanStack Query |
| **라우팅** | React Router DOM v6 |
| **차트** | Recharts |
| **폼** | React Hook Form + Zod |

---

## 🏛️ 조직 구조

### 부서 체계 (사신수 기반)

| 부서 코드 | 이름 | 정식 명칭 | 아이콘 | 역할 | 업무 방식 |
|-----------|------|-----------|--------|------|----------|
| `baekho` | 백호 | 신규조사반 | 🐯 | 재난 접수 및 조사, 위험 등급 판정 | 하향식 배정 (Top-down) |
| `hyunmu` | 현무 | 출동구조반 | 🐢 | 긴급 출동 및 구조 활동, 정기 순찰 | 자율 선택 (Voluntary) |
| `jujak` | 주작 | 현장정리반 | 🐦 | 현장 정리 및 안정화, 사후 처리 및 은폐 | 하향식 배정 (Top-down) |

### 요원 등급 및 상태

```
요원 등급: 주무관, 실무관, 팀장 등
요원 등급: 주무관, 실무관, 팀장 등
요원 상태: 정상 | 부상 | 오염 | 실종 | 사망 | 퇴사 | 휴직
```

---

## 🔒 인증 시스템

### 페르소나 키 로그인
- **로그인 방식**: 이름 입력 (비밀번호 필드 없음)
- **플레이스홀더**: "이름을 입력하십시오."
- **페르소나 로직**: 입력된 이름이 소속 부서 데이터와 일치할 때 해당 부서의 UI 및 권한 자동 활성화

### 특수 페르소나 긴급 인증 (v1.3 업데이트)

원작 설정에 따라 **'최요원'과 '해금'**은 본명이 아닌 가명/코드명입니다. 이 두 이름으로 일반 로그인 시도 시 특수 인증 절차가 필요합니다.

**인증 플로우**:
```
1. 유저가 '최요원' 또는 '해금' 입력 후 [접속] 클릭
   ↓
2. 로그인 차단 + 경고 팝업 표시
   "정의할 수 없는 신원입니다" (5초 후 자동 사라짐)
   ↓
3. 유저가 [긴급 인증] 버튼 클릭
   ↓
4. 팝업 모달 오픈:
   "긴급구호요청 콜번호를 입력하시오."
   "숫자만 입력하시오."
   ↓
5. 올바른 콜번호 입력 시:
   - 스피너 애니메이션 (5초)
   - "인증되었습니다" 메시지
   - 메인 대시보드로 이동
```

**긴급구호요청 콜번호**: `1717828242` (시스템 내부 하드코딩)

### 등록된 페르소나 및 데이터 관리 전략 (Data Nature-Based Architecture)

시스템의 데이터는 **데이터의 성격(Nature)**에 따라 3가지 계층으로 구분됩니다.

#### 1. 전사 공통 데이터 (Global Data) - `src/data/global/`
- **대상**: 모든 사용자에게 동일하게 표시
- **데이터 종류**:
  - **공지사항** (notifications.json) - 전사 공지
  - **장비 목록** (equipment.json) - 전체 장비 종류 및 재고
  - **방문 장소** (locations.json) - 방문 가능한 시설 목록
  - **기본 재난** (incidents.json) - 전사 차원에서 관리되는 기본 재난 5건
- **특징**: 초자연재난관리국의 **공통 인프라 정보**로, 누가 로그인하든 동일하게 표시됩니다.

#### 2. 평범한 요원 개인 데이터 (Ordinary Personal Data) - `src/data/ordinary/`
- **대상**: 네임드 요원이 아닌 ID로 로그인한 모든 유저
- **신분**: **9급 실무관** (직급 고정), 부서는 랜덤 배정
- **데이터 종류**:
  - **쪽지함** (messages.json) - 일상적인 업무 협조 메시지
  - **결재 문서** (approvals.json) - 평범한 보고서 및 신청서
  - **일정** (schedules.json) - 일반적인 업무 스케줄
  - **검사 예약** (inspections.json) - [NEW] 오염 검사 예약 정보
  - **추가 재난** (incidents.json) - 현재 비어있음 (향후 확장 가능)
- **특징**: "초자연재난관리국의 평범한 공무원으로서의 삶" 체험. 일상적이고 반복적인 업무 데이터만 제공됩니다.

#### 3. 페르소나 개인 데이터 (Persona Personal Data) - `src/data/personas/{캐릭터명}/`
- **대상**: 지정된 ID로 로그인한 유저 (총 7명)
- **신분**: 원작 설정에 따른 구체적 직급 및 배경 보유
*   **아이콘**: `lucide-react`를 사용하여 깔끔하고 직관적인 라인 스타일 아이콘 사용.
        *   **부서 아이콘 (사방신)**: `src/components/icons/DeptIcons.tsx`의 커스텀 SVG 컴포넌트 사용 (Heavy/Solid 스타일로 무게감 부여).
        *   **이모티콘 사용 금지**: 공공기관의 신뢰성을 위해 UI 및 데이터에서 이모티콘 사용을 배제함.
- **폴더 구조**: 각 캐릭터마다 별도 폴더에 5개 파일
  ```
  personas/
  ├── parkhonglim/
  │   ├── profile.json        # [NEW] 요원 프로필
  │   ├── messages.json       # 캐릭터 전용 쪽지
  │   ├── notifications.json  # 캐릭터 전용 공지
  │   ├── approvals.json      # 캐릭터 전용 결재
  │   ├── approvals.json      # 캐릭터 전용 결재
  │   ├── schedules.json      # 캐릭터 전용 일정
  │   └── inspections.json    # [NEW] 캐릭터 전용 검사 예약
  ├── choiyowon/
  ├── ryujaegwan/
  ├── solum/
  ├── haegeum/
  ├── koyoungeun/
  └── janghyeowoon/
  ```
- **특징**: "주요 등장인물의 스토리라인" 체험. 해당 캐릭터만의 **전용 시나리오, 특수 보고서, 인간관계 데이터**가 제공됩니다.

#### 데이터 병합 로직 (`src/data/dataManager.ts`)

데이터 타입에 따라 **다른 병합 전략**을 사용합니다:

**1) 재난 정보 (Incidents)**: 전사 공통 + 개인 전용
```typescript
getIncidents: (agent) => {
    // [v1.6] 모든 재난 데이터 통합 (Unified)
    return GLOBAL_INCIDENTS;
}
```

**2) 공지사항 (Notifications)**: 전사 공통 + 개인 전용
```typescript
getNotifications: (agent) => {
    const global = GLOBAL_NOTIFICATIONS;
    if (!agent) return global;

    switch (agent.name) {
        case '박홍림': return [...PARKHONGLIM_NOTIFICATIONS, ...global];
        // ... 전사 공지 + 개인 공지 병합
    }
}
```

### 1.3 세션 데이터 지속성 및 동기화 (Session Persistence & Synchronization) - [UPDATED]

시스템은 로그인 세션 동안 발생하는 사용자의 활동을 유지하기 위해 **`sessionStorage`**와 **`Context API`**를 적극 활용합니다.

| 데이터 영역 | 관리 주체 (Context) | 저장소 Key | 지속 범위 | 동기화 방식 |
|-------------|---------------------|------------|-----------|-------------|
| **이스터에그 상태** | `InteractionContext` | `haetae_triggered_ids` | 세션 | 모든 페이지 연동 (트리거 시 즉시 반영) |
| **정신 오염도** | `UserContext` | `haetae_contamination` | 세션 | 새로고침 시 유지, 로그아웃 시 초기화 |
| **업무 내역 (세션)** | `WorkContext` | `haetae_session_schedules` 등 | 세션 | 대시보드 및 업무 페이지 실시간 동기화 |
| **재난 상태 (수락)** | `WorkContext` | `haetae_session_accepted_tasks` | 세션 | `processedIncidents`를 통해 전역 반영 |

**핵심 아키텍처 (Single Source of Truth)**:
*   `WorkContext`가 재난 및 업무 데이터의 **단일 진실 공급원** 역할을 수행합니다.
*   **글로벌 가시성 필터링**: `InteractionContext`의 트리거 목록(`triggeredIds`)을 참조하여, 아직 발동조건(예: 30초 대기)을 충족하지 못한 숨겨진 재난/공지는 **앱 전체에서 원천적으로 차단**합니다.
*   이를 통해 대시보드, 상황판, 담당 업무 등 모든 페이지에서 **동일한 재난 목록과 상태**를 보장합니다.
```

**3) 쪽지/결재/일정 (Messages/Approvals/Schedules)**: 개인 전용만
```typescript
getMessages: (agent) => {
    if (!agent) return ORDINARY_MESSAGES;

    switch (agent.name) {
        case '박홍림': return PARKHONGLIM_MESSAGES;
        // ... 개인 데이터만 반환 (전사 공통 없음)
    }
}
```

**4) 장비/방문장소 (Equipment/Locations)**: 전사 공통만
```typescript
getEquipment: () => GLOBAL_EQUIPMENT;  // 모든 사용자에게 동일
getLocations: () => GLOBAL_LOCATIONS;  // 모든 사용자에게 동일
```

| 이름 | 부서 | 팀 | 코드 | 코드명 | 급수 | 특징 | 전용 데이터 |
|------|------|-----|------|--------|------|------|-------------|
| **박홍림** | 출동구조반 | 현무1팀 | HMU-001 | 홍화 | 6급 | **[휴직]** 장기 요양 (오염) | 재난 2건, 쪽지 7건, 공지 0건, 결재 0건, 일정 0건 |
| **최요원** | 출동구조반 | 현무1팀 | HMU-002 | 미상 | 7급 | 사고 다발, 주간 검진 | 재난 3건, 쪽지 4건, 공지 2건, 결재 3건, 일정 5건 |
| **류재관** | 출동구조반 | 현무1팀 | HMU-003 | 청동 | 8급 | 부적 전문, 체계적 | 재난 2건, 쪽지 5건, 공지 1건, 결재 1건, 일정 4건 |
| **v2.0** | 2026-01-03 | UI Refinement: Dashboard 'My Assignments' -> 'Real-time Waiting Tasks'. UI Standardization: TasksPage 'Request List' / 'My Tasks' unification. Logic Override: Session-accepted status sync on Incidents Board. Refactor: Centralized Incident Status Logic. | | | | | |
| **김솔음** | 출동구조반 | 현무1팀 | HMU-004 | 포도 | 7급 | **[휴직]** 25.04.24~ (오염) | 재난 2건, 쪽지 13건, 공지 1건, 결재 0건, 일정 0건 |
| **해금** | 출동구조반 | 현무3팀 | HMU-301 | 해금 | 6급 | 3팀 팀장, 멸형급 대응 | 재난 2건, 쪽지 6건, 공지 1건, 결재 5건, 일정 1건 |
| **고영은** | 신규조사반 | 백호2팀 | BKH-201 | 박하 | 7급 | **[퇴사]** 25.04.29 | 재난 4건, 쪽지 3건, 공지 0건, 결재 3건, 일정 0건 |
| **장허운** | 현장정리반 | 주작2팀 | JJK-201 | 화각 | 7급 | **[휴직]** 25.03.28~ (오염) | 재난 3건, 쪽지 3건, 공지 1건, 결재 3건, 일정 11건 |




### 보안 수칙
- 페르소나 키(이름)는 외부 노출 금지
- 시스템 등급: **대외비**
- 배경 워터마크: 화면 중앙에 `[대외비] 접속자: 이름(날짜)` 표시

### 시간대별 시스템 변화
- **야간 (22:00~06:00)**:
  - 야간 순찰 대상 재난 강조 표시
  - 특정 시설 야간 예약 가능
  - 긴급 구조 요청 우선 노출
- **주간 (06:00~22:00)**:
  - 일반 업무 모드
  - 정기 순찰 목록 표시

---

## 📄 페이지 구조 및 메뉴 체계

### GNB (Global Navigation Bar) - 7대 메뉴
| 경로 | 페이지 | 메뉴명 | 설명 |
|------|--------|--------|------|
| `/` | Dashboard | 메인 | 부서별 맞춤형 대시보드 |
| `/mypage` | MyPage | 개인정보 | 개인 정보, 장례법 선택 |
| `/notices` | NoticesPage | 공지사항 | 전체 공지 및 부서별 필독 지침 |
| `/messages` | MessagesPage | 쪽지함 | 사내 메신저 (업무 협조, 비공식 정보 교류) |
| `/resources` | ResourcesPage | 업무지원 | 장비 대여, 시설 예약, 오염 검사 통합 페이지 |
| `/approvals` | ApprovalsPage | 결재 | 보고서 작성 및 결재 문서 관리 |
| `/tasks` | TasksPage | 담당업무 | 업무 배정 및 처리 (목록/캘린더 뷰 지원) |

---

## 📊 메인 대시보드 레이아웃

### 메인 대시보드 레이아웃
**구조**: 상단(Header) + Ticker + 2단 그리드 (Main 8 : Sidebar 4)

1. **상단: 재난 경보 티커 (Disaster Ticker)**
   - **위치**: GNB 하단, 최상단
   - **기능**: 현재 진행 중인 고위험(뇌형 이상) 재난 실시간 롤링 표시
   - **목적**: 긴급 상황 전파 및 분위기 조성

2. **메인 영역 (좌측/중앙)**
   - **실시간 대기 업무 (Real-time Waiting Tasks)**: 부서별 대기 상태인 업무 표시 (접수/구조대기/정리대기). 수락 시 본인 업무 목록으로 이동하며 이 위젯에서는 사라짐.
   - **통합 재난 현황 (Incident List)**: 전체 재난 리스트 (지도/통계 대체), 실시간 진행 상태 파악 (세션 수락 건 즉시 '진행 중' 반영)

3. **사이드바 (우측)**
   - **요원 상태 모니터 (Agent Status)**: 정신 오염도(%) 및 신체 상태 시각화
   - **행정 알림 (Admin Alerts)**: 결재 대기, 장비 반납/연체 알림
   - **주간 일정 (Mini Schedule)**: 오늘/내일 주요 일정 간략 표시

### 부서별 가변 섹션
각 부서의 업무 특성에 따라 리스트/현황/배정 영역의 내용이 동적으로 변경됩니다.

---

## ⚠️ 재난(어둠) 관리

### 위험 등급 체계 (형刑 시스템)

초자연 재난관리국은 재난의 위험도를 "형(刑)" 체계로 분류합니다.

| 등급 | 스타일 | 색상 | 정의 | 특징 |
|------|--------|------|------|------|
| **멸형** (滅刑) | abyssal | 보라색 | 사망처리자 오십만 명 이상 | 최고 위험 등급, 특수 장비 필수, 국가적 재난 |
| **파형** (破刑) | destructive | 빨간색 | 수십 년간 수백 명 실종 | 종결 불가능, 봉인만 가능, 정기 순찰 필수 |
| **뇌형** (瀨刑) | warning | 주황색 | 수십 년간 수십 명 피해 | 봉인 가능, 장기 관찰 필요 |
| **고형** (苦刑) | muted | 회색 | 인명피해 없음 | 낮은 위험도, 일반 대응 가능 |

**등록번호 체계**: `0000PSYA.연도.가00` 형식
- 예: `0001PSYA.2025.가01` - 2025년 첫 번째 재난

### 재난 처리 워크플로우 (데이터 연동 흐름)

```
접수 → 조사중 → 구조대기 → 구조중 → 정리대기 → 정리중 → 종결
(백호)   (백호)     (현무)      (현무)     (주작)       (주작)    (완료)
```

**상태 전환 트리거**:
1. **접수**: 외부 제보 데이터 유입 시 자동 생성
2. **조사중 → 구조대기**: 백호팀 조사 보고서 승인 시
3. **구조대기 → 구조중**: 현무팀 요원 승낙 시
4. **구조중 → 정리대기/종결**: 현무팀 출동일지 작성 시 (정리 요청 체크 여부에 따라)
5. **정리대기 → 정리중**: 주작팀 배정 시
6. **정리중 → 종결**: 주작팀 정리 보고서 승인 시



### 재난 대응 매뉴얼 시스템
일부 특수 재난은 현장 요원의 생존율을 높이기 위해 전용 **대응 매뉴얼**을 보유하고 있습니다.

- **연동 방식**: 재난 데이터(`incidents.json`)에 `manualId`가 존재하면, 해당 사실을 UI에 배지로 표시합니다.
- **구성**:
  - **식별 징후**: 재난의 물리적/비물리적 특징
  - **행동 수칙**: 즉시 수행해야 할 생존 행동
  - **금기 사항**: 절대 하지 말아야 할 행동 (위반 시 사망 위험)

### 대응 장비 (도깨비공방 제작)

초자연 재난관리국의 주요 장비는 **도깨비공방**과의 비밀 협력을 통해 제작됩니다.

#### 필수 장비
- **해태상**: 결계 설치용 (필수장비)
- **도깨비불**: 어둠 속 길 안내
- **악의 저울**: 오염도 측정
- **간이 유리감옥**: 소형 개체 봉인

#### 특수 장비
- **은심장** (Silver Heart):
  - 은색 뱃지 형태, "CHARGE" 각인
  - 기능: 착용자가 "선한 사람"으로 인정받아 집단 영향력 행사
  - 제약: 고위급 장비, 팀장 이상 결재 필수
  - 역사: 탐라행 급행열차 사건 이후 대여만 가능

- **도깨비 초롱**:
  - 기능: 특수 조명 및 탐사 장비
  - 제약: 3일 후 재충전 필요, 공용 장비로 전환
  - 경고: 생년월일 제출 시 도깨비 시련 발동 위험

- **도깨비 감투**:
  - 기능: 투명화 능력
  - 등급: 고위급 장비, 특별 승인 필요

#### 일반 장비
- **줄잡이**: 괴담 속 존재 포획/제어
- **신발끈**: 이동 및 탈출용
- **유리 손포**: 오염 물질 취급용 장갑

**작전 중에는 실명 노출 금지 규칙이 적용됩니다. 모든 요원은 코드명으로 호출됩니다.**

---

## 📋 부서별 업무 프로세스 상세

### 5.1. 신규조사반 (백호) - 조사 및 판정

**업무 방식**: 하향식 배정 (Top-down)

**대시보드 구성**:
- **요청 목록** (Read-only): 외부(경찰/민간)에서 접수된 조사 요청 목록 (개인 선택 불가) - **[목록/캘린더]** 뷰 제공
- **현황**: 월간 접수 / 조사 중 / 조사 완료(이관) 건수
- **나의 업무**: 팀장이 지정했거나 내가 착수한 조사 건

**담당 업무**:
1. 배정된 건의 상세 제보 내용(녹취, 이미지) 확인
2. 조사 수행 후 **[조사 결과 보고서]** 작성
3. 위험도 등급 판정 → **[결재]** 상신
4. 승인 시 사건 상태가 자동으로 **'구조 대기'**로 변경

---

### 5.2. 출동구조반 (현무) - 긴급 구조 및 순찰

**업무 방식**: 자율 선택 (Voluntary) 및 팀 단위 배정

**대시보드 구성**:
- **요청 목록**: 실시간 발생 구조 대기 요청 (클릭 시 [승낙 팝업] 후 '나의 업무'로 배정)
- **현황**: 월별 요청 / 구조 중 / 완료 건수
- **나의 업무**: 내가 수락하여 현재 진행 중인 긴급/순찰 임무 목록

**담당 업무**:
1. **상세 정보 확인**:
   - 기본 정보: 위치, 시간
   - 재난 심화 정보: 파훼법, 진입 제한
   - (순찰의 경우) 지난 순찰 특이사항
2. **출동 완료 보고**: 복귀 후 **[출동/순찰 일지]** 작성 → **[결재]** 상신
3. **현장 인계 (NEW)**:
   - 보고서 작성 단계에서 **[현장 정리 요청]** 버튼 활성화
   - 클릭 시 해당 재난 건이 '현장정리반'의 업무 리스트로 이관
   - 체크하지 않으면 '종결' 처리

**정기 순찰 자동 생성**:
- 매일 자정, 시스템이 순찰 정책 데이터를 확인하여 오늘 순찰해야 할 재난 목록을 현무팀 리스트에 자동 노출

**긴급 소집 시스템** (이스터에그):
- 멸형급 재난 발생 시 전 현무팀에 긴급 알림
- 알림 형태: 화면 전체 빨간색 깜빡임 + 사이렌 효과음 (선택적)
- "긴급 구조 요청 - 즉시 승낙 바랍니다" 팝업
- 승낙 시 즉시 배정 및 상세 정보 표시

---

### 5.3. 현장정리반 (주작) - 사후 처리 및 은폐

**업무 방식**: 하향식 배정 (Top-down) - 구조반 요청 혹은 상부 지시 건을 팀장이 배정

**대시보드 구성**:
1. **[좌측 하단] 요청 목록** (정리 대기): 현무팀(구조반)이나 상부에서 넘어온 실시간 정리 대기 목록 (Read Only)
2. **[우측 상단] 현황** (정리 통계): 이번 달 요청 / 진행 중 / 정리 완료 건수
3. **[우측 하단] 나의 업무** (정리 중): 팀장이 나에게 배정한 정리 건

**담당 업무 페이지**:
1. **나의 업무 리스트**: 본인 할당 목록
2. **상세 정보 뷰어**:
   - 재난 발생 및 구조 완료 내역 (이전 단계 보고서 열람)
   - 파괴/오염 수준 확인
   - 정리 목표: 물리적 복구, 목격자 기억 소거, 오염 잔해 수거
3. **정리 완료 보고**:
   - 임무 완수 후 **[결재]** 페이지를 통해 '현장 정리 완료 보고서' 기안
   - 승인 시 해당 재난 데이터는 아카이브(보관소)로 이동하며 최종 **'종결'**

---

## 🧰 업무지원 (Resources) 시스템

기존의 '장비'와 '방문' 페이지가 통합된 **업무지원** 페이지에서 처리합니다.

### 1) 장비 대여 신청 (Asset Rental)

**구분 로직**:
- **일반 대여**: [신청] 버튼 즉시 활성화
- **고위급 장비**: [결재 요청] 버튼 활성화 → 팀장 이상 결재 필수

**프로세스**: 품목 선택 → 대여 기간 설정 → 사유 입력 → 신청/결재

#### 일반 장비 (승인 필요)
| 장비명 | 설명 | 재고 | 승인 | 특이사항 |
|--------|------|------|------|----------|
| 도깨비불 🔥 | 어둠 속 길 안내용 | 10개 | ✅ | - |
| 악의 저울 ⚖️ | 오염도 측정 장비 | 5개 | ✅ | - |
| 간이 유리감옥 🏺 | 소형 개체 봉인용 | 8개 | ✅ | - |
| 해태상(소형) 🦁 | 결계 설치용 | 12개 | ✅ | - |
| 줄잡이 🪢 | 괴담 존재 포획/제어 | 15개 | ✅ | - |
| 신발끈 👟 | 이동 및 탈출용 | 20개 | ✅ | - |

#### 고위급 장비 (팀장 이상 결재)
| 장비명 | 설명 | 재고 | 승인 | 특이사항 |
|--------|------|------|------|----------|
| 은심장 💎 | 집단 영향력 행사 | 3개 | ✅✅ | 탐라행 급행열차 사건 참고 |
| 도깨비 초롱 🏮 | 특수 조명 및 탐사 | 5개 | ✅✅ | 3일 후 재충전 필요 |
| 도깨비 감투 👤 | 투명화 능력 | 2개 | ✅✅ | 특별 승인 필요 |

### 2) 장비 지급 신청 (Consumables)

**특징**: 소모품이므로 별도 승인 절차 없음. 단, 사유 제출 필수.

**프로세스**: 품목 및 수량 선택 → 사유 입력(필수) → [지급 신청] → 즉시 수령 대기

| 물품명 | 설명 | 재고 |
|--------|------|------|
| 유리 손포 🧤 | 오염 물질 취급용 장갑 | 500개 |
| 포승줄 🪢 | 봉인 문양 특수 포승줄 | 200개 |
| 시큼달큼 🍬 | 정신 오염 해독용 사탕 | 1000개 |
| 메모리얼 그립톡 📱 | 기억 고정용 액세서리 | 150개 |

### 3) 서비스 신청
- **오염 검사 신청**: 정기/정밀/긴급 검사 신청
- **기숙사 입주/연장 신청**

---

## 📍 시설 방문 예약 (Facilities)

**업무지원 > 시설** 탭에서 이용 가능합니다.

### 예약 프로세스
**UI/UX**: 장소 선택 → 월별 캘린더 팝업 → 빈 시간대(Slot) 클릭 → 예약 사유 입력 → 신청

**시스템 동작 원리 (v1.3 업데이트)**:
- **동적 슬롯 생성**: 각 시설의 **운영시간(operatingHours)**을 파싱하여 예약 가능한 시간대 슬롯을 동적으로 생성합니다.
- **세션 캐싱**: 예약 데이터는 클라이언트의 `sessionStorage`에 임시 저장되어 새로고침 시에도 유지됩니다.
- **유효성 검사**: 당일 예약 시 현재 시간 이전의 슬롯은 자동으로 비활성화됩니다.

**제약 사항**:
- 실시간 날짜 기준 과거 날짜/시간 선택 불가
- 이미 예약된 시간대는 비활성화(Grayed out)
- 본인 예약 완료 시 해당 슬롯 마감 처리

### 방문 가능 장소

| 장소 | 설명 | 승인 필요 | 운영시간 | 특이사항 |
|------|------|----------|----------|----------|
| 도깨비 공방 🔧 | 특수 장비 제작/수리 | ❌ | 09:00-18:00 | 초재관 주요 장비 제작처, 비밀 협력 관계 |
| 바리데기 세공소 📿 | 봉인 장치/부적 제작 | ❌ | 10:00-17:00 | - |
| 이정 책방 📚 | 고문서 열람/연구 | ❌ | 08:00-20:00 | - |
| 용천 선녀탕 ♨️ | 정신 오염 정화 시설 | ✅ | 06:00-22:00 | 오염도 -30% 효과 |

#### 도깨비 공방 상세
- **역할**: 초자연 재난관리국의 주요 장비 제작 파트너
- **협력 관계**: 비밀 협력 계약, 장비 등록번호 관리
- **특수 서비스**:
  - 장비 제작 의뢰 (주임급 이상 연 2회 무료)
  - 장비 수리 및 재충전
- **경고**: 도깨비 초롱 개인화 신청 시 도깨비 시련 발동 위험

#### 용천 선녀탕 특례
- **기능**: 정신 오염 정화 (오염도 -30% 효과)
- **승인**: 다른 장소와 달리 예약 신청 시 **[결재]**가 필요
- **긴급 예약**: 오염도 70% 이상 시 긴급 예약 가능
- **추천**: 정기적인 방문으로 오염도 관리 권장

---

## 📝 결재 시스템

### 기능
각종 보고서, 승인 필요 장비/장소 신청 건에 대한 기안 및 진행 현황 확인

### 문서 종류
- 조사보고서
- 출동일지 / 순찰일지
- 현장정리보고서
- 시말서
- 장비 품의서
- 방문 품의서

### 결재 라인 정보
- 기안자, 결재자(팀장/본부장)
- 현재 승인 상태: 작성중 → 결재대기 → 승인 / 반려

### 결재 상태별 배지
`[조사중]` (파란색), `[반려]` (빨간색), `[미확인]` (보라색)

### 시말서 템플릿

시스템에서 제공하는 표준 시말서 템플릿:

1. **도깨비 시련 발동 사고**
   - 사유: 도깨비 초롱/도깨비 장비 부적절한 사용
   - 재발방지: 장비 사용 매뉴얼 숙지 서약

2. **장비 분실**
   - 사유: 재난 현장에서 장비 분실/파손
   - 처리: 변상 또는 재발방지 교육

3. **민간인 목격 사고**
   - 사유: 작전 중 일반 시민에게 초자연 현상 노출
   - 처리: 기억 소거 조치 및 보안 교육

4. **실명 노출**
   - 사유: 작전 중 실명 사용 (코드명 미사용)
   - 처리: 보안 규정 위반, 재교육

---

## 👤 마이페이지 기능

### 요원 정보

#### 기본 신원 정보
- **이름**: 본명 (페르소나 키)
- **코드명**: 작전명 (예: 포도, 청동, 해금)
- **소속**: 백호/현무/주작 팀
- **직급**: 주무관, 실무관, 팀장 등
- **내선번호**: 사내 연락처

#### 작전 상태
- **현재 상태**: 정상 | 부상 | 오염 | 실종 | 사망 | 퇴사 | 휴직
- **오염도**: 0~100% (실시간 표시)
  - 0~30%: 정상 (녹색)
  - 31~69%: 주의 (노란색)
  - 70~89%: 위험 (주황색)
  - 90~100%: 심각 (빨간색)
- **오염도 증가**: 로그인 시간에 비례하여 자동 증가
- **오염도 감소**: 용천 선녀탕 방문 시 -30%

#### 활동 이력
- **총 처리 재난 수**: XX건 (특수 케이스 X건)
- **보유 장비**: 현재 대여 중인 장비 목록 (반납일, 연체 여부 표시)
- **정화 이력**: 용천 선녀탕 방문 기록 (최근 5회)

### 장례법 지정 신청
요원 사망 시 적용되는 장례 방식 사전 선택:

**[장례법 지정 신청]** 버튼 클릭 → 모달 팝업 호출

팝업 내용: *"순직 시 희망하는 장례 절차를 선택하십시오."*

1. **화장**: 전통적 방식
2. **매장**: 전통적 방식
3. **수목장**: 자연 친화적 방식
4. **데이터 소각**: 모든 기록 영구 삭제 (확인 팝업 2회)
5. **기억 소거 후 방생**: 관련자 기억 소거 후 신원 재설정 (윤리적 경고문)

**저장 시 인사기록 DB에 즉시 반영**

### 코드명 시스템

**목적**: 작전 중 실명 노출 금지 규칙 준수

**사용 규칙**:
- 모든 재난 현장에서는 코드명으로만 호출
- 출동일지, 순찰일지에 코드명 사용
- 실명 사용 시 시말서 제출

**코드명 예시**:
- 현무팀: 포도, 청동, 해금
- 백호팀: 호박, 은빛, 진주
- 주작팀: 주홍, 단풍, 석류

---

## 8. 인터랙티브 이스터에그 (Interactive Easter Eggs) v1.4

시스템의 몰입감을 높이기 위해 특정 조건 만족 시 발동하는 인터랙티브 이벤트 시스템입니다.

### 8.1 작동 원리 (InteractionContext)
- **트리거 (Trigger)**: 데이터(`json`)에 정의된 `trigger` 필드를 기반으로 동작
- **감지 로직**: 로그인 시 `InteractionContext`가 트리거 조건을 분석하고 타이머를 설정
- **상태 관리**:
  - `triggeredIds`: 이미 발동된 이벤트 ID 목록
  - `readIds`: 사용자가 확인한(읽은) 이벤트 ID 목록

### 8.2 시나리오: 강남역 포식자 싱크홀
- **발동 조건**: 로그인 후 5초 경과 (`time-elapsed`)
- **이벤트 시퀀스**:
  1. **긴급 공지 등록**: "강남역 대규모 멸형(파형) 재난 발생" 공지가 자동으로 리스트에 추가됨
  2. **GNB 뱃지 점멸**: 공지사항 메뉴에 빨간색 점멸 뱃지 표시 (읽기 전까지 유지)
  3. **재난 경보 티커**: 상단 티커에 해당 재난 내용이 빨간색으로 롤링 시작
  4. **재난 목록 갱신**: 재난 현황 페이지에 '강남역 싱크홀' 건이 페이드인 효과와 함께 등장 (반짝임 효과 3회)

### 8.3 데이터 구조 예시
```json
{
  "id": "noti-sinkhole-alert",
  "trigger": {
    "type": "time-elapsed",
    "delay": 5000
  }
}
```

### 8.4 정신 오염 게임오버 (Mental Contamination & Game Over)
- **오염도 메카니즘**:
  - **자연 증가**: 현실 시간 **10초당 1%**씩 증가
  - **감소 방법**:
    - **오염 검사 신청**: -5% (ResourcesPage)
    - **용천 선녀탕 방문**: -30% (ResourcesPage > Facilities)
  - **실시간 반영**: 대시보드 위젯 및 마이페이지에서 실시간 수치 확인 가능
- **정신 오염 게임오버 (Mental Contamination)**:
  - **발동 조건**: 정신 오염도 100% 도달 시 즉시 발동
  - **화면 연출 (검열 및 퇴출 연출)**:
    1. **데이터 검열 (Censorship)**: 7초간 현재 보고 있는 화면의 모든 텍스트가 **'■'** 문자로 변환됨 **(지수적 가속 적용)**.
    2. **부적 결계 (Talisman Screen)**: 화면 전체가 즉시 **황색(#FFC400)**으로 전환됨 (암전 단계 없음).
    3. **축객 명령 (Expulsion)**: 황색 배경 중앙에 거대한 적색 **'退 (물러날 퇴)'** 글자가 애니메이션 없이 즉시 나타남 (부적 형상).
    4. **강제 추방 (Force Logout)**: 시스템 강제 로그아웃 및 리다이렉트.

### 8.5. 보안 처형 게임오버
  - **발동 조건**: **금지된 신원(죄인 명단)으로 로그인 시도 시** 즉시 발동
    - 금지된 신원 명단 : 호유원, 청달래, 백석주, 진나솔, 이석종, 강도준, 이성해, 이자헌, 은하제, 박민성, 윤조훈, 백사헌, 강이학, 이재진, 이승조, 곽제강, 이연화, 최명진, 박경환, 이병진, 이강헌, 김허운
  - **화면 연출 (텍스트 기반 공포 연출)**:
    1. **시스템 동결 (Freeze)**: 3초간 화면이 회색조(Grayscale)로 변하며 모든 상호작용이 불가능해짐 (시스템 오류로 위장).
    2. **적색 점멸 (Flash)**: 2초간 화면 전체가 붉은색/검은색으로 점멸 (경고음 없음)
    3. **초기 타이핑 (Initial Typing)**: 검은 화면 중앙에 흰색 **'狱' (감옥 옥)** 글자가 타이핑됨.
    4. **정적 (Hold)**: 3초간 공포스러운 정적 유지.
    5. **폭주 (Infinite Typing)**: 10초간 화면 전체에 **"죄인은 오랏줄을 받으라"** 문장이 글자 단위로 타이핑되며 스크롤됨. (속도가 점점 빨라지는 가속 효과 적용)
    6. **강제 로그아웃**: 로그인 화면으로 리다이렉트.

---

## 🎨 디자인 시스템 (Design Guide v1.2)

### 디자인 원칙 (Design Principles)

1. **신뢰성 (Trustworthy)**: 국가 행정 시스템으로서의 권위와 안정감
2. **가독성 (Legibility)**: 긴박한 재난 상황에서도 정보를 오독하지 않도록 명확한 대비
3. **표준화 (Standardization)**: 대한민국 전자정부 표준 프레임워크 기반의 익숙한 UI/UX
4. **반전 (The Twist)**: 평범한 UI 속에 '부적', '혈흔', '경고문' 등의 콘텐츠가 위화감 있게 배치

### 컬러 시스템 (G-Color 기반)

#### 주조색 (Primary Colors)
```css
--gov-blue: #2c5598;      /* 헤더(GNB), 주요 버튼, 활성화된 메뉴 */
--gov-dark-grey: #333333; /* 본문 텍스트, 기본 아이콘 */
--gov-light-grey: #f4f4f4; /* 배경색, 테이블 헤더 배경 */
```

#### 기능색 (Functional Colors)
```css
/* 부서별 색상 */
--baekho: /* 백호(조사) - 호랑이 */
--hyunmu: /* 현무(구조) - 거북이 */
--jujak:  /* 주작(정리) - 봉황 */

/* 재난 및 상태 표시 */
--danger-red: /* 멸형급 재난, 접근 금지, 결재 반려 */
--alert-yellow: /* 오염 구역, 주의 요망 재난 */
--safe-green: /* 구조 완료, 안전 구역, 결재 승인 */
--abyssal-violet: /* 물리 법칙 초월 수치, 정신 오염도, 시스템 에러(글리치) */
```

### 타이포그래피 (Typography)

**국문/영문**: Pretendard 또는 Noto Sans KR
**숫자**: Monospace (좌표, 시간, 재고 수량 표시 시)

**크기 및 두께**:
- 헤드라인: Bold, 20~24px (페이지 타이틀)
- 본문: Regular, 14~16px
- 캡션: Regular, 12px (부가 설명)

### 레이아웃 & 그리드

#### 상단 GNB (Global Navigation Bar)
- 높이: 60~80px의 고정 헤더
- 좌측: [태극 문양] + '환경부 초자연재난관리국' 로고 (KRDS 시그니처 조합)
- 우측: 접속자 정보(이름/소속), 로그아웃, 알림 아이콘
- **알림 뱃지**: 중요/긴급 공지 발생 시 점멸하며, 해당 **공지를 읽은 시점**에 사라짐 (단순 페이지 방문 X)

#### 콘텐츠 영역
- **카드형 UI**: 흰색 배경 + 옅은 회색 테두리(1px solid #ddd), 그림자 최소화 (플랫 디자인)
- **테이블**: 상단 헤더 옅은 회색 배경, 텍스트 중앙 정렬, 셀 간 구분선 명확

### UI 컴포넌트 (Components)

#### 버튼 (Buttons)
- **라운딩**: 2~4px (직각에 가까운, 딱딱한 관공서 느낌)
- **레이블**: '확인', '취소', '신청', '결재 상신' 등 명사형 종결

#### 인풋 및 폼 (Inputs & Forms)
- **입력 필드**: 회색 테두리의 직사각형 박스
- **필수 입력값**: 라벨 옆에 빨간 점(•) 표시
- **셀렉트 박스**: 시스템 기본 스타일(Native Select) 사용 (투박한 느낌 유지)

#### 뱃지 및 태그 (Badges)
재난 등급이나 결재 상태를 표시하는 알약 모양의 태그

예: `[조사중]` (파란색), `[반려]` (빨간색), `[미확인]` (보라색)

#### 아이콘 (Icons)
- 미니멀한 라인(Line) 아이콘
- 일반 아이콘 외에 '부적', '유리구슬', '해태상' 모양의 픽토그램 혼용

### 특수 효과 및 질감

#### 배경 워터마크
보안 유지를 위해 화면 중앙에 희미하게 대각선으로 표시:
```
[대외비] 접속자: 김솔음(2025-12-31)
```

#### 다크 모드 (야간 작전 모드)
- **목적**: 현장 요원들이 어두운 곳(폐가, 지하실)에서 접속할 때 눈부심 방지
- **배경색**: 완전한 검정(#000000)보다는 짙은 남색(#121212) 사용
- **고대비**: 텍스트 가독성 최우선

#### 애니메이션
- `pulse-glow`: 은은한 빛남 효과
- `glitch`: 글리치 효과 (오류/이상 표시)

---

## 🗄️ 데이터 아키텍처 (Data Architecture)

### 데이터 분류 체계

> **참고**: 상세한 데이터 스키마 및 관리 규칙은 **[DATA_SPECIFICATION.md](./DATA_SPECIFICATION.md)**를 참고하십시오.
> - **타입 정의**: `src/types/haetae.ts`
> - **상수 정의**: `src/constants/haetae.ts`
> - **데이터 접근**: `src/data/dataManager.ts`

### 데이터 지속성 정책 (Data Persistence Policy v1.4)
시스템은 보안 등급 유지를 위해 **로컬 세션 기반의 임시 데이터 저장** 방식을 채택합니다.

*   **정적 데이터 (Static)**: 재난 목록, 공지사항 등 기본 데이터는 JSON 파일에서 로드 (Read-only).
*   **동적 데이터 (Dynamic)**: 사용자가 생성한 **신청(Rentals), 예약(Schedules), 결재(Approvals)** 데이터는 `sessionStorage` 및 메모리(`AuthContext`)에만 임시 저장됩니다.
*   **초기화**: 브라우저 탭을 완전히 닫거나 로그아웃 시, 사용자가 생성한 데이터는 보안을 위해 **자동 소기(초기화)**됩니다.

초자연재난관리국 인트라넷 시스템은 **데이터의 성격(Nature)**에 따라 3계층 구조로 설계되었습니다.

#### 계층 1: 전사 공통 데이터 (Global Data)
**위치**: `src/data/global/`
**특징**: 모든 사용자에게 동일하게 표시되는 기반 데이터

| 파일 | 데이터 타입 | 설명 |
|------|------------|------|
| incidents.json | GLOBAL_INCIDENTS | 전사 차원에서 관리되는 기본 재난 5건 |
| notifications.json | GLOBAL_NOTIFICATIONS | 전사 공지사항 (모든 요원이 확인) |
| equipment.json | GLOBAL_EQUIPMENT | 장비 목록 및 재고 현황 |
| locations.json | GLOBAL_LOCATIONS | 방문 가능한 시설 목록 |

**병합 로직**:
- 재난/공지사항: 개인 데이터와 병합하여 제공
- 장비/방문장소: 단독으로 제공 (개인 데이터 없음)

#### 계층 2: 평범한 요원 개인 데이터 (Ordinary Personal Data)
**위치**: `src/data/ordinary/`
**특징**: 네임드가 아닌 일반 요원의 개인 업무 데이터

| 파일 | 데이터 타입 | 설명 |
|------|------------|------|
| messages.json | ORDINARY_MESSAGES | 일상적인 업무 협조 쪽지 5건 |
| messages.json | ORDINARY_MESSAGES | 일상적인 업무 협조 쪽지 5건 |
| approvals.json | ORDINARY_APPROVALS | 평범한 보고서 및 신청서 5건 |
| schedules.json | ORDINARY_SCHEDULES | 일반 업무 일정 6건 |

**병합 로직**:
- 재난: GLOBAL_INCIDENTS + ORDINARY_INCIDENTS
- 공지사항: GLOBAL_NOTIFICATIONS만 (개인 공지 없음)
- 쪽지/결재/일정: 개인 데이터만 제공

#### 계층 3: 페르소나 개인 데이터 (Persona Personal Data)
**위치**: `src/data/personas/{캐릭터명}/`
**특징**: 7명의 주요 캐릭터별 맞춤형 스토리 데이터

각 페르소나 폴더는 5개 파일로 구성:
- **profile.json**: 요원 프로필 정보 (직급, 오염도, 장비 등) - 소스 분리됨
- **messages.json**: 캐릭터 관련 쪽지 (1~4건)
- **notifications.json**: 캐릭터 전용 공지 (0~2건)
- **approvals.json**: 캐릭터 전용 결재 문서 (0~3건)
- **schedules.json**: 캐릭터 전용 일정 (0~5건)

**병합 로직**:
- 요원 정보: `profile.json` (AuthContext 로드)
- 재난: GLOBAL_INCIDENTS (단일 소스)
- 공지사항: GLOBAL_NOTIFICATIONS + {캐릭터}_NOTIFICATIONS
- 쪽지/결재/일정: {캐릭터} 개인 데이터만 제공

---

### 1. 사용자 및 조직 데이터 (User & Organization)
시스템의 주체인 요원들의 신원과 권한을 정의

**주요 필드**:
- 기본 신원 정보: 이름, 고유 ID, 직급, 소속 부서, 연락처(내선번호)
- 보안 및 인증 정보:
  - **페르소나 키 (이름)**: 로그인 시 입력하는 '한글 이름 석 자'
  - 소속(백호/현무/주작) 데이터와 일치할 때만 해당 부서의 UI 활성화
  - **데이터 트랙 분기**: 이름이 7명 페르소나에 매칭되면 personas/ 데이터 사용, 아니면 ordinary/ 데이터 사용
- 상태 정보: 정상 / 부상 / 오염 / 실종 / 사망 / 퇴사 / 휴직
- 특수 행정 정보: **[희망 장례법]** (순직 시 처리 방식 데이터)

---

### 2. 재난 및 사건 데이터 (Incidents Lifecycle)
초자연 재난의 생성부터 소멸까지의 정보

**데이터 소스 구조**:
```
전사 기본 재난 (GLOBAL_INCIDENTS)
  ↓
= 사용자에게 표시되는 최종 재난 목록 (통합됨)
```

**주요 필드**:
- **사건 식별 정보**: 사건 고유 번호(YYYYMMDD-001), 발생 위치(GPS/주소), 위험 등급
- **상태값 (Status Flow)**: 사건의 현재 진행 단계
  ```
  접수 (백호팀 노출) → 조사 중 → 구조 대기 (현무팀 노출) → 구조 중
  → 정리 대기 (주작팀 노출) → 정리 중 → 종결
  ```
- **상세 속성 정보**:
  - 제보 데이터: 최초 신고 내용, 녹취록, 이미지
  - 분석 데이터: 파훼법, 진입 제한 (조사 후 업데이트)
  - 순찰 대상 여부: 정기 순찰 필요 여부 (True/False)

---

### 3. 업무 배정 데이터 (Assignments)
'누가(User)' '어떤 사건(Incident)'을 '무슨 목적(Type)'으로 맡았는지 연결

**주요 필드**:
- 배정 유형: 조사 / 구조(긴급) / 구조(순찰) / 현장 정리
- 연결 정보: 담당 요원 ID + 대상 사건 ID
- **배정 방식 (로직)**:
  - **지명 배정**: 백호/주작팀 - 팀장이 요원을 지정하여 데이터 생성
  - **자율 배정**: 현무팀 - 요원이 '승낙' 버튼을 누르는 순간 본인 ID로 데이터 생성

---

### 4. 정기 순찰 정책 데이터 (Patrol Rules)
매일 발생하는 루틴 업무를 자동 생성하기 위한 규칙

**주요 필드**:
- 대상 재난: 순찰이 필요한 '안정화된 재난'의 ID
- 주기 규칙: 매일 / 매주 특정 요일 / 매월 특정 일
- 갱신 데이터: 마지막 순찰 일시 (다음 순찰 예정일 계산 기준)

**자동 실행**: 매일 자정, 시스템이 순찰 정책 데이터를 확인하여 오늘 순찰해야 할 재난 목록을 현무팀 리스트에 자동 노출

---

### 5. 결재 및 보고서 데이터 (Reports & Approvals)
업무의 결과를 증명하고, 다음 단계로 넘어가기 위한 트리거(Trigger) 역할

**주요 필드**:
- 문서 유형: 조사 보고서, 출동/순찰 일지, 현장 정리 보고서, 장비 신청서, 시말서 등
- 결재 라인 정보: 기안자, 결재자(팀장/본부장), 현재 승인 상태(대기/승인/반려)
- **핵심 결과 데이터**:
  - 위험도 판정: 조사 보고서 승인 시 확정되는 등급
  - 구조 인원 수: 출동/순찰 일지에 기록
  - **인계 요청 여부**: 현무팀이 보고서 작성 시 '현장 정리'를 요청했는지 여부

---

### 6. 자산 및 시설 데이터 (Assets & Facilities)

**장비 재고**:
- 품목명, 전체 수량, 현재 대여 가능 수량

**시설 예약 로그**:
- 방문 장소(도깨비 공방 등), 예약자, 방문 예정 일시
- **연동 규칙**: 예약이 확정되면 해당 시간대는 '예약 불가(Lock)' 상태로 변경

---

### 7. 일정 데이터 (Schedules)
메인 대시보드 '주 단위 일정'에 표시하기 위해 여러 데이터를 통합한 뷰(View)

**데이터 원천**:
1. 배정 데이터에서 '작전 수행일' 가져옴
2. 시설 예약 로그에서 '방문 예정일' 가져옴
3. 결재 데이터에서 '마감일' 등을 가져옴

→ 이 모든 정보를 모아 날짜/시간 순으로 정렬하여 사용자에게 표시

---

## 📂 프로젝트 구조

```
src/
├── App.tsx                 # 메인 앱 + 라우팅
├── main.tsx               # 엔트리포인트
├── index.css              # 전역 스타일
├── components/
│   ├── ui/               # shadcn/ui 컴포넌트
│   ├── icons/            # 사용자 정의 아이콘
│   │   └── DeptIcons.tsx    # 부서 아이콘 (백호/현무/주작)
│   ├── layout/           # 레이아웃 컴포넌트
│   │   └── GNBHeader.tsx    # 글로벌 네비게이션 바
│   ├── dashboard/        # 대시보드 위젯
│   │   ├── DepartmentStats.tsx   # 부서별 통계
│   │   ├── IncidentList.tsx      # 재난 목록
│   │   ├── MyAssignments.tsx     # 내 업무
│   │   ├── NoticeWidget.tsx      # 공지사항
│   │   ├── WeeklySchedule.tsx    # 주간 일정
│   │   ├── DisasterTicker.tsx    # 재난 경보 티커
│   │   ├── AdminAlertWidget.tsx  # 행정 알림
│   │   ├── AgentStatusWidget.tsx # 요원 상태 모니터
│   │   └── MiniWeeklySchedule.tsx # 주간 일정 (사이드바용)
│   ├── work/             # 업무 관련 컴포넌트
│   │   ├── IncidentCard.tsx      # 재난 카드
│   │   ├── TasksCalendar.tsx     # 일정 캘린더
│   │   └── ManualViewer.tsx      # 매뉴얼 뷰어
│   └── manual/           # 매뉴얼 관련 컴포넌트
├── contexts/
│   └── AuthContext.tsx   # 인증 컨텍스트
├── constants/
│   └── haetae.tsx       # 상수 정의 (부서, 장례법 등)
├── data/
│   ├── dataManager.ts    # 데이터 병합 로직 (중앙 관리)
│   ├── global/           # 전사 공통 데이터 (JSON)
│   │   ├── incidents.json   # 기본 재난 5건
│   │   ├── notifications.json # 전사 공지사항
│   │   ├── equipment.json   # 장비 목록 및 재고
│   │   ├── locations.json   # 방문 가능 시설
│   │   └── manuals.json     # 재난 대응 매뉴얼
│   ├── ordinary/         # 평범한 요원 개인 데이터 (JSON)
│   │   ├── incidents.json   # 추가 재난 (현재 비어있음)
│   │   ├── messages.json    # 일상 쪽지
│   │   ├── approvals.json   # 일반 결재 문서
│   │   └── schedules.json   # 일반 일정
│   └── personas/         # 7명 페르소나별 개인 데이터 (JSON)
│       ├── parkhonglim/     # 박홍림 (HMU-001, 홍화)
│       │   ├── incidents.json
│       │   ├── messages.json
│       │   ├── notifications.json
│       │   ├── approvals.json
│       │   └── schedules.json
│       ├── choiyowon/       # 최요원 (HMU-002, 미상)
│       ├── ryujaegwan/      # 류재관 (HMU-003, 청동)
│       ├── solum/           # 김솔음 (HMU-004, 포도)
│       ├── haegeum/         # 해금 (HMU-301, 해금)
│       ├── koyoungeun/      # 고영은 (BKH-201, 박하)
│       └── janghyeowoon/    # 장허운 (JJK-201, 화각)
│           ├── incidents.json
│           ├── messages.json
│           ├── notifications.json
│           ├── approvals.json
│           └── schedules.json
├── hooks/
├── pages/                # 각 페이지 컴포넌트
├── types/
│   └── haetae.ts        # 타입 정의
└── lib/
```

### 데이터 구조 설계 원칙

1. **성격 기반 분류**: 데이터를 사용자 타입이 아닌 **데이터의 성격(전사 공통 vs 개인별)**으로 분류
2. **명확한 분리**: 전사 공통 데이터(global), 평범한 요원 데이터(ordinary), 페르소나 데이터(personas)를 물리적으로 분리
3. **확장성**: 각 페르소나의 데이터를 별도 폴더로 관리하여 개별 수정 및 확장 용이
4. **병합 전략**: dataManager.ts에서 데이터 타입별로 다른 병합 로직 적용 (incidents/notifications는 global + personal, messages/approvals/schedules는 personal만)

---

## 🚀 실행 방법

```bash
# 의존성 설치
npm install

# 개발 서버 실행
npm run dev

# 프로덕션 빌드
npm run build
```

---

## 📋 참고 문서

프로젝트 루트에 다음 PDF 문서들이 포함되어 있습니다:
- `초자연 재난관리국 인트라넷.pdf` - 시스템 기획안 (v1.2)
- `[디자인] 초자연 재난관리국 인트라넷 디자인 가이드.pdf` - 디자인 가이드
- `데이터 아키텍처 정의서.pdf` - DB 구조 및 데이터 아키텍처

---

## 🌐 세계관 키워드

| 용어 | 설명 |
|------|------|
| 해태 | 시스템 명칭, 재난을 막는 상상의 동물 |
| 어둠 | 초자연적 재난 현상의 총칭 |
| 페르소나 | 요원의 정체성/이름 |
| 코드명 | 작전 중 사용하는 암호명 (실명 노출 금지) |
| 사신수 | 백호, 현무, 주작 (부서 체계 기반) |
| 형(刑) | 재난 등급 체계 (멸형/파형/뇌형/고형) |
| 정신 오염 | 어둠 노출로 인한 상태 이상 |
| 오염도 | 정신 오염 수치 (0~100%) |
| 결계 | 어둠을 봉쇄하는 보호 장치 |
| 도깨비공방 | 초자연 장비 제작처, 비밀 협력 관계 |
| 탐라행 급행열차 사건 | 은심장 대여 제한 정책의 기원이 된 과거 사건 |
| G-Color | 정부 전용 색상 시스템 |
| 대외비 | 시스템 보안 등급 |

---

## 🎯 세계관 몰입 요소 및 이스터에그

### 4.1 시스템 알림 및 특수 트리거 (Notifications & Easter Eggs)

**1) 시간차 발동 재난 (Time-Elapsed Trigger)**
*   특정 재난은 로그인 직후에는 보이지 않다가, 일정 시간이 경과해야 시스템에 감지됩니다.
*   **대표 사례**: `강남역 포식자 싱크홀`
    *   **발동 조건**: 로그인 후 **30초 경과**
    *   **효과**:
        1.  30초 전까지는 모든 목록에서 **은폐** (Hidden).
        2.  30초 타이머 종료 시, 해당 공지의 생성 시각을 **'현재 시각(Real-time)'**으로 재설정.
        3.  대시보드 및 공지사항 최상단에 **[긴급]** 배지와 함께 경보 발생.

**2) 우선순위 공지 정책**
*   **정신 건강 권장**: "정신 감응형 재난 예방" 공지가 기본적으로 목록 최상단에 고정됩니다 (싱크홀 발동 전까지).
*   **날짜 랜덤화**: 일반 공지들은 `2026-01-01` ~ `2026-01-03` 사이의 날짜가 랜덤하게 배정되어 사실감을 부여합니다.

### Footer 메시지
모든 페이지 하단에 표시:

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
이 시스템은 환경부 산하 초자연재난관리국 전용입니다.
무단 접속 시 국가보안법에 의거 처벌받을 수 있습니다.
보안 유지는 시민의 안전입니다.

© 2026 환경부 초자연재난관리국 | v1.3-CLASSIFIED
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 404 페이지 커스텀

페이지를 찾을 수 없을 때 표시되는 메시지:

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⚠️  접근 오류

[오류 코드: 404]
요청하신 페이지를 찾을 수 없습니다.

가능한 원인:
• 접근 권한이 없는 재난 정보
• 이미 종결된 재난 기록
• 어둠에 의해 삭제된 페이지
• 잘못된 등록번호

[메인으로 돌아가기]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 로딩 메시지
비동기 작업 중 표시되는 메시지 (랜덤 선택):
- "재난 정보를 불러오는 중..."
- "페르소나 인증 중..."
- "철뱃지 확인 중..."
- "등급 판정 중..."
- "결재 라인 확인 중..."


---

## 🛠️ 시스템 아키텍처 및 유지보수 (System Architecture & DevOps)

### 1. 정적 자산 및 저장소 관리 (Repository Diet)
- **외부 라이브러리 정책**: `krds-uiux.zip` 등 대용량 외부 디자인 리소스는 저장소에 직접 포함시키지 않고, npm 패키지나 CDN을 통해 관리하거나 필요한 시점에 다운로드하는 방식을 지향합니다.
- **Git 최적화**: 불필요한 대용량 바이너리 파일을 제거하고 `.gitignore`를 통해 엄격하게 관리하여 `git clone` 및 배포 속도를 최적화했습니다.

### 2. 데이터 파이프라인 자동화 (Automated Pipeline)
- **목적**: 빌드/배포 시 데이터 생성 과정을 망각하여 발생하는 "좀비 배포(텅 빈 데이터)" 방지
- **구현**: `package.json`의 수명주기 스크립트(`prescript`)를 활용하여 빌드 전 항상 최신 데이터를 생성합니다.
  - `dev` (개발 서버) 실행 시 → `generateDynamicData.cjs` 자동 실행
  - `build` (프로덕션 빌드) 실행 시 → `generateDynamicData.cjs` 자동 실행
- **명령어**:
  ```bash
  # 개발 모드 (데이터생성 -> Vite 실행)
  npm run dev

  # 빌드 (데이터생성 -> Vite 빌드)
  npm run build
  ```

### 3. 데이터 상속 구조 (Data Inheritance)
- **Base Template**: 공통적인 조직 일정, 전사 공지사항 등은 `data-templates/personas/_base/`에서 관리합니다.
- **Merge Logic**: 스크립트가 각 페르소나 데이터를 생성할 때, `_base` 데이터를 먼저 로드하고 그 위에 개별 페르소나 데이터를 병합(Merge)합니다.
  - **배열(Array)**: Base 항목 뒤에 개별 항목을 추가 (Concat)
  - **객체(Object)**: Base 속성을 개별 속성이 덮어씀 (Override)

### 4. 컴포넌트 구조 (Component Architecture) - [v2.0 UPDATE]

#### 4.1 페이지별 컴포넌트 분리 정책
대규모 페이지 컴포넌트는 기능 단위로 분리하여 유지보수성을 높입니다.

**Resources 관련 컴포넌트**:
```
src/components/resources/
├── index.ts              # Barrel export
├── EquipmentCard.tsx     # 장비 카드 (재사용)
├── InspectionForm.tsx    # 검사 신청 폼
└── visitUtils.ts         # 방문 예약 유틸리티 함수
```

**Dashboard 컴포넌트**:
```
src/components/dashboard/
├── IncidentSummary.tsx   # 재난 현황 요약 (useWork 사용)
├── MyAssignments.tsx     # 실시간 대기 업무 (useWork 사용)
├── DisasterTicker.tsx    # 재난 경보 티커 (useWork 사용)
├── PersonalInfoWidget.tsx
├── AdminAlertWidget.tsx
└── MiniWeeklySchedule.tsx
```

#### 4.2 데이터 소스 정책 (Single Source of Truth)
> **중요**: 모든 재난 관련 컴포넌트는 반드시 `useWork().processedIncidents`를 사용해야 합니다.
> `DataManager.getIncidents()` 직접 호출은 금지됩니다 (트리거 필터링 우회 방지).

### 5. 유틸리티 모듈 (Utility Modules) - [v2.0 UPDATE]

공통적으로 사용되는 로직은 `src/utils/` 디렉토리에서 관리합니다.

#### `src/utils/dateUtils.ts`
| 함수 | 설명 |
|------|------|
| `parseNotificationDate()` | 다양한 형식(ISO, relative:, fixed:)의 날짜 문자열을 Date 객체로 변환 |
| `safeFormatDate()` | 에러 발생 시 폴백 처리가 포함된 안전한 날짜 포맷팅 |
| `isNewItem()` | 항목이 "신규"인지 판단 (기본 7일 이내) |

---

*© 2026 환경부 초자연재난관리국*
*v1.3-CLASSIFIED*
